{
  "@context": "https://huijoohwee.github.io/schema/AgenticRAG/v1/context.jsonld",
  "@id": "rag:Markdown",
  "@type": "rdfs:Class",
  "schemaVersion": "1.0.29",
  "rdfs:label": [
    { "@value": "Markdown", "@language": "en-us" },
    { "@value": "Markdown", "@language": "zh-cn" }
  ],
  "rdfs:comment": [
    {
      "@value": "Describes Markdown documents used as neutral, dataset-agnostic inputs and exports for AgenticRAG workflows. Markdown content remains schema-agnostic; pipelines map sections and code blocks into GraphRAG-friendly nodes, edges, and chunk_text while keeping JSON-LD graphs and canvas views structurally aligned. In Canvas, the Bottom Panel Markdown Editor/Viewer keeps source text and preview together. The Contents panel may be rendered on the left and may include a Source Files tree (folder/file hierarchy derived from `/` in file names) with icon-only create actions. The Viewer renders preview using GFM-first markdown tokenization with a CommonMark-style fallback, supports word wrap and a slide-style Presentation Mode, and anchors selection back to document line ranges via metadata.documentPath and metadata.lineStart/metadata.lineEnd (with provenance tracked via metadata.timestamp and optional metadata.documentUrl). Token sharing is implemented between the Editor (TOC generation) and Viewer (Preview rendering) to avoid redundant lexing, ensuring optimal performance during mode switches; Presentation Mode renderers should key tokens by documentPath + line ranges to prevent per-slide state leakage. When composing chat context, Canvas may expand a selected node’s line range to a section-aware excerpt bounded by Markdown headings (ATX `#`…`######` and Setext), avoids breaking fenced code blocks, and trims to a small character budget (~2000 chars). Presentation Mode supports Slidev-style slide splitting using standalone `---` separators (outside code fences), an optional MDX evaluation path for embedding safe JSX components inside slides, and zoomable full-screen inspection for Mermaid diagrams. Preview rendering may optionally promote safe rich media embeds (images, video links, and common iframe providers) without requiring schema changes to the Markdown content. For fenced code blocks, implementations may expose a single global Beside/Inline/Render mode in the Markdown Viewer header so all code blocks follow the same layout; per-block overrides may exist but should clear automatically when they match the global mode so future global changes apply. Selecting Render may also enable frontmatter visibility for documents that start with YAML frontmatter. Render mode fits supported previews (e.g., Mermaid diagrams, GeoJSON via MapLibre) into the full code block area. GeoJSON previews should be available regardless of the Geospatial Mode overlay toggle (Document Mode and Geospatial Mode both allow Viewer/Presentation map previews) while reusing the same basemap style configuration. GeoJSON rendering may default to Render for `geojson` blocks and for `json` blocks when an integration detects GeoJSON content; map previews may follow the same overlay conventions as Mermaid (fullscreen overlay in container-scope, open Geospatial panel in viewport-scope). Mermaid code blocks may optionally include a leading YAML `--- ... ---` header to configure that block’s Mermaid init settings. Render mode should reuse the Geospatial Mode basemap style configuration while deferring map initialization until visible to reduce memory/render overhead. Canvas may also ingest external sources (e.g., PDF/HTML/YouTube transcripts) by converting them into Markdown while preserving provenance via metadata.documentUrl. When Geospatial Mode is available, implementations may optionally extract embedded fenced `geojson` code blocks (GeoJSON FeatureCollection) from local Markdown inputs and register them as bounded overlay dataset layers without hardcoding any external URLs.",
      "@language": "en-us"
    },
    {
      "@value": "用于 AgenticRAG 工作流的 Markdown 文档类型，强调中立、与数据集无关的输入与导出形式。Markdown 内容本身不携带特定模式假设，流水线将段落和代码块映射为适合 GraphRAG 的节点、边和 chunk_text，同时保持 JSON‑LD 图和画布视图在结构上的一致性。Canvas 的 Bottom Panel Markdown Editor/Viewer 提供 Markdown 源文本编辑与预览；其中 Contents 面板可渲染在左侧，并可包含 Source Files 树形导航（按文件名中的 `/` 派生文件夹/文件层级）与图标式创建动作。预览使用以 GFM 为优先的 Markdown 分词与接近 CommonMark 的回退策略渲染，支持 Word Wrap 与幻灯片式 Presentation Mode，并通过 metadata.documentPath 与 metadata.lineStart/metadata.lineEnd 将选中节点/边锚定回文档行区间（来源信息通过 metadata.timestamp 以及可选的 metadata.documentUrl 记录）。在编辑器（TOC 生成）和预览器（渲染）之间实现了 Token 共享，以避免模式切换时的冗余词法分析，确保最佳性能；在 Presentation Mode 中应使用 documentPath + 行区间作为渲染 key 以避免跨幻灯片的状态泄漏。 在构建聊天上下文时，Canvas 可将选中节点的行区间扩展为基于 Markdown 标题边界的片段（ATX `#`…`######` 与 Setext），避免在 fenced code block 内截断，并裁剪到较小的字符预算（约 2000 字符）。Presentation Mode 支持 Slidev 风格的独立 `---` 分隔符（代码块外）分页、可选的 MDX 求值以在幻灯片中嵌入安全的 JSX 组件，以及 Mermaid 图的可缩放全屏查看。预览渲染可选地将安全的富媒体嵌入（图片、视频链接、常见 iframe 提供方）提升为可视内容，而无需修改 Markdown 内容的 schema。对于 fenced 代码块，实现可在 Markdown Viewer 头部提供全局 Beside/Inline/Render 模式，使所有代码块遵循同一布局；同时允许单块覆盖，但当单块模式与全局模式重新一致时应自动清除覆盖状态，以便后续全局切换继续生效。选择 Render 时也可为以 YAML frontmatter 开头的文档自动启用 frontmatter 可见性。Render 模式将支持的预览（例如 Mermaid 图、通过 MapLibre 渲染的 GeoJSON）适配并铺满代码块区域；GeoJSON 预览应与地理空间叠加层开关解耦（文档模式与地理空间模式下均允许 Viewer/Presentation 渲染地图预览），同时复用相同的底图样式配置。其中 `geojson` 代码块可默认进入 Render，而 `json` 代码块在识别为 GeoJSON 内容时也可默认进入 Render；GeoJSON 地图预览也可复用 Mermaid 的交互约定（容器范围用全屏 Overlay 查看，视口范围打开地理空间面板）。Mermaid 代码块可在内容开头放置 YAML `--- ... ---` 头部，用于配置该代码块的 Mermaid 初始化设置。Render 模式应复用地理空间模式的底图样式配置且将地图初始化延后到可见时以降低内存/渲染开销。Canvas 也可将外部来源（如 PDF/HTML/YouTube 字幕）转换为 Markdown 进行摄取，并通过 metadata.documentUrl 保留溯源。当可用地理空间模式时，实现也可以选择性地从本地 Markdown 输入中提取内嵌 fenced `geojson` 代码块（GeoJSON FeatureCollection），并以有界方式注册为叠加层数据集图层，且不得硬编码任何外部 URL。",
      "@language": "zh-cn"
    },
    {
      "@value": "Markdown text SSOT: Editor, Viewer, and Presentation must render the same markdown text source for the active document. Implementations must not require strict path equality between an active document path (e.g. sandbox/docs/demo.md) and a stored document name (e.g. demo.md); prefer store/imported markdown when identities match by basename, and fall back to store/imported text on fs-load failure for that same match to prevent an empty editor while the preview still has content.",
      "@language": "en-us"
    },
    {
      "@value": "Markdown 文本 SSOT：Editor、Viewer、Presentation 必须渲染同一份当前文档 Markdown 文本。实现不得强制要求 activeDocumentPath（例如 sandbox/docs/demo.md）与已存储的文档名（例如 demo.md）完全相等；当 basename 匹配时应优先使用 store/import 的 markdown，并在相同 basename 场景下 @fs 加载失败时回退到 store/import 文本，从而禁止出现“预览有内容而编辑器为空”。",
      "@language": "zh-cn"
    },
    {
      "@value": "Cross-surface markdown sync: Slides Gallery, Graph Data, and Canvas projections must render the same markdown text SSOT for the active document and must not reuse memoized markdown token caches across different activeDocumentPath values; cached tokens may be reused only when the stored tokens path matches the activeDocumentPath (prevents cross-document bleed and content disappearing on view switches).",
      "@language": "en-us"
    },
    {
      "@value": "跨界面 Markdown 同步：Slides Gallery、Graph Data 与 Canvas 的投影视图必须渲染同一份当前文档 Markdown 文本 SSOT，且不得在不同 activeDocumentPath 之间复用已记忆化的 Markdown token 缓存；仅当缓存记录的 tokensPath 与 activeDocumentPath 相同才可复用（防止跨文档串扰与视图切换时内容消失）。",
      "@language": "zh-cn"
    }
  ],
  "markdownUiGuidelines": {
    "noExternalEditorJsDependency": "Do not import, embed, or copy Editor.js; keep Markdown editing/rendering native and dependency-free.",
    "wysiwygLikeFormatting": "Provide Editor.js-like affordances via native controls (e.g., formatting buttons applying Markdown syntax to the current selection) while keeping the canonical document as Markdown text.",
    "viewerBlockEditing": "In Viewer mode, allow bounded block-style operations (e.g., heading grip drag reorder among same-parent siblings and inserting a new blank line after a block) implemented as pure Markdown text transforms using TOC/line semantics; avoid WYSIWYG block state.",
    "tocReorderHandleOnly": "Enable TOC reorder drag only from a dedicated grip handle; avoid making the whole row draggable to prevent accidental reorders.",
    "tocFocusFromOtherSurfaces": "Allow non-markdown projections (e.g., Graph Table / Graph Data Table) to request TOC focus using a stable event contract (e.g., dispatch CustomEvent('kg:tocFocus', {detail:{id}})). The id must be a stable heading identifier derived from shared slugify/anchor rules; do not invent per-surface ids.",
    "sidebarAndCollapsePersistence": "Persist Markdown sidebar-open state and collapsed heading ids via canonical, app-namespaced LocalStorage keys (no magic strings).",
    "ssotMarkdownSectionHeader": "Use one-and-only Markdown Section Header implementation across Editor/Viewer/Presentation; do not introduce mode-specific header variants.",
    "ssotMarkdownSidebar": "Use one-and-only Markdown Explorer sidebar structure across modes. The sidebar may include an action menu in the Source Files section header for VS Code-like parity; other section headers remain typography-only. Actions must reuse the same underlying integrations as the Markdown header (no duplicate logic paths).",
    "docsiteSpaExport": "Allow exporting a folder of Markdown files into a static documentation website that renders Markdown client-side with SPA routing; keep Markdown as SSOT and avoid domain coupling.",
    "docsiteFileConventions": "Support common docsite conventions: README.md as home, optional _sidebar.md and _navbar.md for navigation, optional _coverpage.md and 404.md for landing/not-found; route paths map to file paths.",
    "docsiteSearchIndex": "If search is enabled, build a bounded index from headings + short excerpts + anchors; avoid shipping unbounded full-text blobs.",
    "persistenceKeys": [
      "kg:ui:markdown:sidebarOpen",
      "kg:ui:markdown:explorer:sourceFilesCollapsed",
      "kg:ui:markdown:explorer:sourceFilesExpandedPaths",
      "kg:ui:markdown:explorer:outlineCollapsed",
      "kg:ui:markdown:explorer:backlinksCollapsed",
      "kg:ui:markdown:collapsedHeadingIds"
    ]
  },
  "markdownPreviewSyntaxSupport": {
    "anchors": [
      {
        "@value": "Preserve explicit anchor targets like <a id=\"...\"></a> (no href) and support deterministic heading ids using a shared slugify function so hash navigation works consistently.",
        "@language": "en-us"
      },
      {
        "@value": "保留显式锚点目标（例如 <a id=\"...\"></a>，无 href），并用共享的 slugify 规则生成确定性的标题 id，以确保 hash 导航一致可用。",
        "@language": "zh-cn"
      }
    ],
    "blockIds": [
      {
        "@value": "Support trailing block-id markers like ^block-id as anchor targets (id=\"^block-id\") so in-doc links can target specific paragraphs/blocks.",
        "@language": "en-us"
      },
      {
        "@value": "支持行尾 block-id 标记（例如 ^block-id）作为锚点目标（id=\"^block-id\"），使文内链接可指向特定段落/块。",
        "@language": "zh-cn"
      }
    ],
    "callouts": [
      {
        "@value": "Support callout syntax as a subset of blockquotes: first line [!type] (e.g., [!info]) and optional + / - to make it foldable (open or collapsed by default).",
        "@language": "en-us"
      },
      {
        "@value": "支持 Callout 语法（作为 blockquote 子集）：首行 [!type]（如 [!info]），并可用 + / - 表示可折叠（默认展开或折叠）。",
        "@language": "zh-cn"
      }
    ],
    "frontmatterMermaidAnchors": [
      {
        "@value": "When YAML frontmatter contains a Mermaid diagram, Mermaid click directives (e.g., click X \"#anchor\") should map to graph edges (pointsTo) targeting Anchor nodes. Frontmatter-focused Canvas views may include these anchors plus any tied internal links and callouts. Producers preserve relative metadata.documentPath segments when available and strip absolute filesystem paths down to basenames to keep provenance portable.",
        "@language": "en-us"
      },
      {
        "@value": "当 YAML frontmatter 含 Mermaid 图时，Mermaid 的 click 指令（如 click X \"#anchor\"）应映射为指向 Anchor 节点的图边（pointsTo）。前置的 Frontmatter 画布视图可包含这些锚点及其关联的文内链接与 Callout。生产者在可用时保留 metadata.documentPath 的相对路径片段，并将绝对文件系统路径剥离为 basename，以保持溯源的可移植性。",
        "@language": "zh-cn"
      }
    ],
    "wikilinks": [
      {
        "@value": "Support wikilinks in both forms: in-doc [[#Heading]] / [[#^block-id]] must render as safe hash links, and file-level [[Note]] / [[Note#Heading]] may resolve against the current Source Files set via loose name normalization (no hardcoded vault paths) and navigate in-app.",
        "@language": "en-us"
      },
      {
        "@value": "支持两类 Wikilink：文内 [[#Heading]] 与 [[#^block-id]] 必须渲染为安全的 hash 链接；文件级 [[Note]] / [[Note#Heading]] 可基于当前 Source Files 集合通过宽松的名称归一化进行解析（禁止硬编码 vault 路径），并在应用内导航。",
        "@language": "zh-cn"
      }
    ],
    "backlinks": [
      {
        "@value": "Backlinks (linked mentions vs unlinked mentions) are derived from Source Files text/link indexing; do not require Markdown content changes and are surfaced as an optional computed sidebar view.",
        "@language": "en-us"
      },
      {
        "@value": "反向链接（已链接提及 vs 未链接提及）可从 Source Files 文本/链接索引推导；无需修改 Markdown 内容，应作为可选的计算侧边栏视图呈现。",
        "@language": "zh-cn"
      }
    ]
    ,
    "mermaidMultiDiagramFences": [
      {
        "@value": "Support multi-diagram Mermaid fences: when a single ```mermaid block contains repeated diagram starts (e.g., multiple graph/flowchart roots), split it into multiple Mermaid render units so every diagram renders deterministically.",
        "@language": "en-us"
      },
      {
        "@value": "支持多图 Mermaid 代码块：当单个 ```mermaid 代码块包含多个图起始声明（例如多次出现 graph/flowchart 根声明）时，应拆分为多个可渲染单元，确保每个图都能确定性渲染。",
        "@language": "zh-cn"
      }
    ]
    ,
    "mmdFileNormalization": [
      {
        "@value": "Treat .mmd (Mermaid-only) documents as first-class Mermaid inputs: normalize raw Mermaid text into a fenced ```mermaid block before parsing and before storing the active Markdown document, so both graph extraction and preview rendering behave consistently.",
        "@language": "en-us"
      },
      {
        "@value": "将 .mmd（仅 Mermaid）文档视为一等 Mermaid 输入：在解析之前、以及写入当前活动 Markdown 文档之前，把原始 Mermaid 文本归一化为 fenced 的 ```mermaid 代码块，从而保证图抽取与预览渲染行为一致。",
        "@language": "zh-cn"
      }
    ]
    ,
    "htmlCodeBlocks": [
      {
        "@value": "In code-block Render mode, render HTML/SVG fenced code blocks as safe HTML (sanitized; no scripts or inline event handlers) and allow drag-to-pan via container scrolling.",
        "@language": "en-us"
      },
      {
        "@value": "在代码块 Render 模式下，将 HTML/SVG fenced code block 渲染为安全 HTML（消毒；禁止 script 与内联事件处理器），并允许通过滚动容器实现拖拽平移。",
        "@language": "zh-cn"
      }
    ],
    "iframeSrcdoc": [
      {
        "@value": "Allow local-only <iframe srcdoc=...> blocks to render as sandboxed iframes (no network dependency; scripts disabled), enabling rich media demos without hardcoded domains.",
        "@language": "en-us"
      },
      {
        "@value": "允许本地化的 <iframe srcdoc=...> 以沙盒 iframe 渲染（不依赖网络；禁用脚本），以便在不硬编码域名的前提下演示富媒体。",
        "@language": "zh-cn"
      }
    ]
  },
  "markdownUiInteractionContract": {
    "textSelectionGestures": [
      {
        "@value": "Viewer/Presentation preserve native selection gestures: single click caret anchor, double click word, triple click paragraph/line. Do not hijack double-click for navigation.",
        "@language": "en-us"
      },
      {
        "@value": "Viewer/Presentation 保持原生选择手势：单击光标锚点、双击选词、三击选段落/行；禁止把双击改成导航。",
        "@language": "zh-cn"
      }
    ],
    "rightClickShowOnIn": [
      {
        "@value": "Right Click opens the app-level \"Show on/in …\" toolbar at the exact pointer position (no fly-out bias).",
        "@language": "en-us"
      },
      {
        "@value": "右键在指针精确位置打开应用级 \"Show on/in …\" 工具条（禁止 fly-out 偏移）。",
        "@language": "zh-cn"
      }
    ],
    "reorderGrip": [
      {
        "@value": "Drag reorder is enabled only from a dedicated grip handle; do not make entire blocks draggable.",
        "@language": "en-us"
      },
      {
        "@value": "拖拽重排仅允许从专用 grip 手柄触发；禁止让整块内容可拖拽。",
        "@language": "zh-cn"
      }
    ],
    "mermaidRenderPanZoom": [
      {
        "@value": "Rendered Mermaid previews support drag/pan (and optional zoom) in code-block Render mode; interaction should be container-scoped and persist per a canonical storage key when enabled.",
        "@language": "en-us"
      },
      {
        "@value": "Mermaid 预览在代码块 Render 模式下支持拖拽平移（可选缩放）；交互应限定在容器范围内，并在启用时通过规范的存储 key 进行持久化。",
        "@language": "zh-cn"
      }
    ],
    "mermaidInDocHashLinks": [
      {
        "@value": "In Mermaid SVGs and rendered HTML, href=\"#...\" links are treated as in-document navigation only and scroll within the Markdown preview container; do not navigate to external URLs.",
        "@language": "en-us"
      },
      {
        "@value": "Mermaid SVG 与渲染 HTML 中的 href=\"#...\" 仅作为文内导航：在 Markdown 预览容器内滚动定位；不得跳转到外部 URL。",
        "@language": "zh-cn"
      }
    ],
    "mermaidPreviewOpenGesture": [
      {
        "@value": "Open Mermaid Preview Panel only on double-click (not single click) so single click remains available for selection and in-doc navigation.",
        "@language": "en-us"
      },
      {
        "@value": "Mermaid 预览面板仅允许通过双击打开（禁止单击打开），以便单击仍用于选择与文内导航。",
        "@language": "zh-cn"
      }
    ],
    "typographyLadder": [
      {
        "@value": "Typography ladder must be monotonic: body < h6 < h5 < h4 < h3 < h2 < h1; presentation mode scales the whole ladder up without inverting ordering.",
        "@language": "en-us"
      },
      {
        "@value": "排版梯度必须单调：正文 < h6 < h5 < h4 < h3 < h2 < h1；演示模式整体放大但不得反转层级顺序。",
        "@language": "zh-cn"
      }
    ]
  },
  "uiPaths": {
    "ui-path-0": [
      {
        "@value": "Canonical Markdown curation path: BottomPanel → Curation → Markdown (Editor/Viewer/Presentation). Keep this path stable across hosts and extracted surfaces.",
        "@language": "en-us"
      },
      {
        "@value": "规范的 Markdown 策展路径：BottomPanel → Curation → Markdown（Editor/Viewer/Presentation）。在宿主与抽取表面间保持该路径稳定。",
        "@language": "zh-cn"
      }
    ]
  },
  "markdownTextSourceOfTruth": [
    {
      "@value": "Editor, Viewer, and Presentation render from a single canonical Markdown text value; switching modes must not create independent stale copies of the same document.",
      "@language": "en-us"
    },
    {
      "@value": "Editor、Viewer 与 Presentation 从单一的规范 Markdown 文本值渲染；模式切换不得生成彼此独立且可能陈旧的副本。",
      "@language": "zh-cn"
    }
  ],
  "localMarkdownCrud": {
    "supportedActions": [
      {
        "@value": "Local Markdown CRUD focuses on create/read/update inside a user-selected folder: Open Folder, New Folder, New Source File, and edit/save text. Delete/rename are optional and must surface capability state explicitly.",
        "@language": "en-us"
      },
      {
        "@value": "本地 Markdown CRUD 聚焦于用户选定目录内的创建/读取/更新：Open Folder、New Folder、New Source File 以及编辑/保存文本。删除/重命名为可选能力且必须明确展示权限状态。",
        "@language": "zh-cn"
      }
    ],
    "browserConsistency": [
      {
        "@value": "Use the Web File System Access API for writable handles when available; otherwise fall back to directory input enumeration for read-only access. UI must clearly communicate read-only vs writable mode and avoid silent no-ops.",
        "@language": "en-us"
      },
      {
        "@value": "可用时使用 Web File System Access API 获取可写句柄；否则回退到目录选择枚举以提供只读访问。UI 必须清晰表达只读/可写模式并避免静默无效操作。",
        "@language": "zh-cn"
      }
    ]
  }
}

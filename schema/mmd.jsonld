{
  "@context": {
    "@version": 1.1,
    "@base": "https://huijoohwee.github.io/schema/mmd.jsonld",
    "@vocab": "https://huijoohwee.github.io/schema/mmd-vocab#",

    "base": "https://huijoohwee.github.io/schema/base.jsonld",
    "core": "https://huijoohwee.github.io/schema/core.jsonld",
    "uc": "https://huijoohwee.github.io/schema/uc.jsonld",
    "kg": "https://huijoohwee.github.io/schema/kg.jsonld",
    "wf": "https://huijoohwee.github.io/schema/wf.jsonld",
    "jdbl": "https://huijoohwee.github.io/schema/jdbl.jsonld",
    "nqds": "https://huijoohwee.github.io/schema/nqds.jsonld",
    "hbs": "https://huijoohwee.github.io/schema/hbs.jsonld",
    "jjnhm": "https://huijoohwee.github.io/schema/jjnhm.jsonld",
    "jsonld": "https://www.w3.org/2013/json-ld-context/rdfa11",

    "rdfs": "http://www.w3.org/2000/01/rdf-schema#",
    "schema": "https://schema.org/",
    "prov": "http://www.w3.org/ns/prov#",
    "xsd": "http://www.w3.org/2001/XMLSchema#",

    "Diagram": "schema:CreativeWork",
    "Node": "mmd-vocab:Node",
    "Edge": "mmd-vocab:Edge",
    "Subgraph": "mmd-vocab:Subgraph",
    "Sequence": "mmd-vocab:Sequence",
    "VisualContract": "mmd-vocab:VisualContract",

    "nodeId": { "@id": "mmd-vocab:nodeId", "@type": "xsd:string" },
    "nodeType": { "@id": "mmd-vocab:nodeType", "@type": "@id" },
    "label": "rdfs:label",
    "shape": "mmd-vocab:shape",
    "style": "mmd-vocab:style",
    "from": { "@id": "mmd-vocab:from", "@type": "@id" },
    "to": { "@id": "mmd-vocab:to", "@type": "@id" },
    "relation": "mmd-vocab:relation",
    "group": "mmd-vocab:group",
    "sequenceOrder": { "@id": "mmd-vocab:sequenceOrder", "@type": "xsd:integer" },
    "referencesType": { "@id": "mmd-vocab:referencesType", "@type": "@id", "@container": "@set" },
    "refsExample": "prov:wasDerivedFrom",
    "docs": "prov:wasDerivedFrom",
    "examplePath": "mmd-vocab:examplePath",
    "created": { "@id": "core:created", "@type": "xsd:dateTime" },
    "updated": { "@id": "core:updated", "@type": "xsd:dateTime" }
  },

  "@id": "https://huijoohwee.github.io/schema/mmd.jsonld",
  "@type": "Diagram",
  "name": "MMD Layer Context",
  "description": "JSON-LD mapping of Mermaid-like diagram constructs (nodes, edges, subgraphs, sequences) to canonical JSON-LD types and visual contract rules; includes validator guidance and example pointers",
  "version": "0.2.0",
  "docs": "https://mermaid.js.org",
  "created": "2025-10-09T00:00:00Z",
  "updated": "2025-10-09T00:00:00Z",

  "examples": [
    {
      "@type": "Diagram",
      "name": "mvp-architecture",
      "description": "Architecture, agent orchestration and timeline diagram for Rapid MVP",
      "examplePath": "/schema/examples/mmd/mvp-architecture.mmd",
      "nodes": [
        {
          "@type": "Node",
          "nodeId": "Orchestrator",
          "label": "Orchestrator",
          "nodeType": "https://huijoohwee.github.io/schema/vocab.jsonld#OrchestratorAgent",
          "shape": "round",
          "style": "fill:#f9f,stroke:#333,stroke-width:2px",
          "referencesType": [
            "https://huijoohwee.github.io/schema/vocab.jsonld#Agent",
            "https://schema.org/SoftwareSourceCode"
          ]
        },
        {
          "@type": "Node",
          "nodeId": "Dashboard",
          "label": "Dashboard",
          "nodeType": "https://huijoohwee.github.io/schema/vocab.jsonld#Dashboard",
          "shape": "box",
          "style": "fill:#bbf,stroke:#333",
          "referencesType": [
            "https://schema.org/WebPage",
            "https://huijoohwee.github.io/schema/vocab.jsonld#UIComponent"
          ]
        }
      ],
      "edges": [
        {
          "@type": "Edge",
          "from": "Orchestrator",
          "to": "Dashboard",
          "relation": "orchestrates",
          "description": "Orchestrator coordinates agents that affect the dashboard",
          "refsExample": "https://huijoohwee.github.io/schema/examples/nqds/orchestrator-to-dashboard.nqds"
        }
      ]
    }
  ],

  "visualContracts": [
    {
      "@type": "VisualContract",
      "name": "DiagramToJSONLD",
      "description": "Diagrams must reference canonical JSON-LD @ids for nodeType when representing system components and flows; edges representing data or control flow should reference NQDS trace IDs or relation IRIs",
      "enforcementLevel": "recommended",
      "validatorHints": {
        "description": "Validate that nodeType IRIs resolve to JSON-LD contexts; verify nodeId uniqueness; ensure edges map to NQDS relations or JDBL directives when representing runtime flows",
        "recommendedTools": [
          "mermaid-cli",
          "mmd-architecture-validator",
          "visual-contract-checker",
          "jsonld.js",
          "nqds-parser"
        ]
      }
    }
  ],

  "validatorHints": [
    {
      "@type": "core:Concept",
      "label": "mmd-syntax",
      "description": "Validate Mermaid/diagram syntax and parseability using mermaid-cli or equivalent",
      "recommendedTools": ["mermaid-cli"]
    },
    {
      "@type": "core:Concept",
      "label": "mmd-uniqueness",
      "description": "Ensure nodeId uniqueness within each diagram and consistent nodeId naming across diagram manifests",
      "recommendedTools": ["mmd-architecture-validator", "kg-diff-checker"]
    },
    {
      "@type": "core:Concept",
      "label": "mmd-type-resolution",
      "description": "Check that nodeType IRIs resolve to JSON-LD contexts or vocabularies and that referenced types exist",
      "recommendedTools": ["jsonld.js", "type-reference-checker"]
    },
    {
      "@type": "core:Concept",
      "label": "mmd-semantic-linkage",
      "description": "Verify that edges asserting flows reference NQDS relation IRIs or JDBL traceIds where appropriate to preserve semantic linkage between visuals and runtime artifacts",
      "recommendedTools": ["nqds-parser", "directive-trace-validator"]
    }
  ],

  "notes": [
    "Mermaid docs: https://mermaid.js.org",
    "Store .mmd artifacts in /schema/examples/mmd/ and include a JSON-LD manifest mapping diagram nodeIds to canonical JSON-LD @ids",
    "Prefer referencing NQDS trace IDs on edges when diagrams represent runtime/instrumented flows to preserve provenance and traceability"
  ]
}
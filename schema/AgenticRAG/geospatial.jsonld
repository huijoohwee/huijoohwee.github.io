{
  "@context": "https://huijoohwee.github.io/schema/AgenticRAG/v1/context.jsonld",
  "@id": "rag:GeospatialMode",
  "@type": "rdfs:Class",
  "schemaVersion": "1.2.0",
  "rdfs:label": [
    { "@value": "Geospatial Mode", "@language": "en-us" },
    { "@value": "地理空间模式", "@language": "zh-cn" }
  ],
  "rdfs:comment": [
    {
      "@value": "Defines a domain-agnostic geospatial visualization and spatial query surface for AgenticRAG graphs. Implementations should transform nodes containing properties.geo.{lat,lng} into GeoJSON Point features for map rendering, support clicking/selecting POIs and synchronizing selection across map and graph views (for example selecting the corresponding node when clicking a graph-node POI on the map), and execute bounded client-side spatial queries (for example proximity search) without unbounded loops or dataset-specific assumptions. Remote dataset fetching must be bounded by configurable timeout/size limits and should fail with actionable errors when limits are exceeded. In 3D render mode, implementations may present a globe-style projection when supported by the map renderer. Ingestion layers should support deriving properties.geo from dataset-agnostic shapes such as GeoJSON Feature/FeatureCollection inputs and generic record datasets (arrays of records or object maps) with common coordinate fields. Note: some runtimes may intentionally expose UI-only affordances without implementing map rendering or spatial query execution.",
      "@language": "en-us"
    },
    {
      "@value": "定义面向 AgenticRAG 图的领域无关地理空间可视化界面。实现应将包含 properties.geo.{lat,lng} 的节点转换为 GeoJSON 点要素用于地图渲染，并支持渲染额外的数据集图层（GeoJSON 与记录式数据集），禁止数据集特定假设。实现应支持在地图上点击/选择 POI 并与图视图选择保持同步（例如点击图节点 POI 时选中对应节点），同时远程数据集拉取必须受可配置的超时/体积限制约束，并在超出限制时给出可操作的错误提示；所有拉取/解析工作需有界并避免无界循环。",
      "@language": "zh-cn"
    }
  ],
  "propertyDefinitions": {
    "mapStyleUrl": {
      "@type": "xsd:string",
      "rdfs:label": [
        { "@value": "Map style URL", "@language": "en-us" },
        { "@value": "地图样式 URL", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "MapLibre vector style URL for the basemap provider (defaulting to an OpenFreeMap Liberty style endpoint if not configured, or a self-hosted style URL). The canonical OpenFreeMap Liberty style URL is https://tiles.openfreemap.org/styles/liberty (note: no /style.json). Implementations should allow configuration rather than hardcoding a single provider, should require an absolute http(s) URL, should reject embedded user credentials (e.g. https://user:pass@host/...), and should fall back to a safe default style when the configured URL is invalid. Implementations may normalize known provider endpoints (for example accept an OpenFreeMap URL ending with /style.json and normalize it to the canonical endpoint).",
          "@language": "en-us"
        },
        {
          "@value": "用于底图提供方的 MapLibre 矢量样式 URL（若未配置则默认使用 OpenFreeMap Liberty 样式端点，或自托管样式 URL）。OpenFreeMap Liberty 样式的规范 URL 为 https://tiles.openfreemap.org/styles/liberty（注意：不带 /style.json）。实现应支持配置而非硬编码单一提供方；应要求绝对的 http(s) URL；应拒绝包含用户凭据的 URL（例如 https://user:pass@host/...）；当配置 URL 无效时应回退到安全的默认样式。实现可对已知提供方端点（例如接受以 /style.json 结尾的 OpenFreeMap URL，并规范化为统一端点）做规范化。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "mapOverlayEnabled": {
      "@type": "xsd:boolean",
      "rdfs:label": [
        { "@value": "Map overlay enabled", "@language": "en-us" },
        { "@value": "地图叠加层启用", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Whether a translucent basemap layer is rendered on top of the main infinite canvas. Implementations should default to false on application load to preserve graph-first affordances.",
          "@language": "en-us"
        },
        {
          "@value": "是否在主无限画布上方渲染半透明底图叠加层。实现应在应用加载时默认关闭，以保留以图为主的交互能力。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "mapOverlayOpacity": {
      "@type": "xsd:decimal",
      "rdfs:label": [
        { "@value": "Map overlay opacity", "@language": "en-us" },
        { "@value": "地图叠加层透明度", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Opacity of the basemap overlay layer. Implementations should clamp to [0,1].",
          "@language": "en-us"
        },
        {
          "@value": "底图叠加层透明度。实现应限制在 [0,1]。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "mapOverlayInteractive": {
      "@type": "xsd:boolean",
      "rdfs:label": [
        { "@value": "Map overlay interactive", "@language": "en-us" },
        { "@value": "地图叠加层可交互", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Whether the overlay map captures pointer/keyboard interactions. For newer implementations, prefer mapInteractionMode to express off / hold-to-interact / always-interact behavior while keeping graph-first defaults. Implementations should default to a graph-first mode on application load.",
          "@language": "en-us"
        },
        {
          "@value": "叠加地图是否捕获指针/键盘交互。新实现建议使用 mapInteractionMode 表达 关闭 / 按住键临时交互 / 始终交互，同时保持以图为主的默认体验。实现应在应用加载时默认采用以图为主的模式。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "mapInteractionMode": {
      "@type": "xsd:string",
      "enum": ["off", "hold-space", "always"],
      "rdfs:label": [
        { "@value": "Map interaction mode", "@language": "en-us" },
        { "@value": "地图交互模式", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Interaction mode for the overlay map: off (graph only), hold-space (temporarily allow pan/zoom while holding Space), or always (map captures pointer interactions). Implementations should default to hold-space or off to preserve graph-first affordances.",
          "@language": "en-us"
        },
        {
          "@value": "叠加地图的交互模式：off（仅图交互）、hold-space（按住 Space 临时允许平移/缩放）、always（地图捕获指针交互）。实现应默认使用 hold-space 或 off，以保留以图为主的交互体验。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "mapProjectionMode": {
      "@type": "xsd:string",
      "enum": ["auto", "mercator", "globe"],
      "rdfs:label": [
        { "@value": "Map projection mode", "@language": "en-us" },
        { "@value": "地图投影模式", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Projection mode for the overlay basemap. Auto lets the runtime choose a suitable projection (for example globe in 3D render mode). Mercator forces a 2D projection. Globe forces a globe-style projection when supported.",
          "@language": "en-us"
        },
        {
          "@value": "叠加底图的投影模式。Auto 由运行时选择合适投影（例如 3D 渲染时使用 globe）。Mercator 强制 2D 墨卡托投影。Globe 在支持时强制球面投影。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "mapAnimateCamera": {
      "@type": "xsd:boolean",
      "rdfs:label": [
        { "@value": "Animate map camera", "@language": "en-us" },
        { "@value": "地图相机动画", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Whether overlay camera moves (for example fit-to-data) should animate rather than jump. Implementations should allow disabling to reduce motion.",
          "@language": "en-us"
        },
        {
          "@value": "叠加层相机移动（例如 fit-to-data）是否使用动画而非瞬移。实现应允许关闭以减少动态效果。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "mapAutoFitEnabled": {
      "@type": "xsd:boolean",
      "rdfs:label": [
        { "@value": "Auto-fit enabled", "@language": "en-us" },
        { "@value": "自动适配启用", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Whether the runtime should auto-fit the overlay camera to active geospatial bounds (commonly enabled in 3D render mode to avoid a blank globe). Implementations should ensure auto-fit is bounded and does not trigger unbounded loops.",
          "@language": "en-us"
        },
        {
          "@value": "运行时是否应自动将叠加层相机适配到当前地理范围（通常在 3D 渲染中启用以避免空白球体）。实现应确保自动适配有界且不会触发无界循环。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "mapOverlayDatasets": {
      "@type": "@json",
      "rdfs:label": [
        { "@value": "Map overlay datasets", "@language": "en-us" },
        { "@value": "地图叠加数据集", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "List of dataset references to render as map overlay layers (points/lines/polygons). Implementations must remain dataset-agnostic and treat sources as opaque URLs or local file references, while validating GeoJSON shapes and bounding fetch size/time. A recommended neutral shape is: [{ id, label, enabled, source: { kind:\"url\", url }, format:\"auto\"|\"geojson\"|\"records\" }].",
          "@language": "en-us"
        },
        {
          "@value": "用于渲染地图叠加层（点/线/面）的数据集引用列表。实现必须保持数据集无关，将来源视为不透明 URL 或本地文件引用，同时校验 GeoJSON 结构并限制拉取体积/耗时。建议的中性数据形态为：[{ id, label, enabled, source: { kind:\"url\", url }, format:\"auto\"|\"geojson\"|\"records\" }]。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "datasetFetchTimeoutMs": {
      "@type": "xsd:integer",
      "rdfs:label": [
        { "@value": "Dataset fetch timeout (ms)", "@language": "en-us" },
        { "@value": "数据集拉取超时（毫秒）", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Maximum time budget for fetching a dataset layer before failing. Implementations should default to a safe bounded timeout and allow configuration (for example via environment variables or settings) without hardcoding dataset-specific values.",
          "@language": "en-us"
        },
        {
          "@value": "拉取数据集图层的最大耗时上限。实现应提供安全的默认超时并允许通过配置（例如环境变量或设置）调整，禁止数据集特定硬编码。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "datasetFetchMaxBytes": {
      "@type": "xsd:integer",
      "rdfs:label": [
        { "@value": "Dataset fetch max bytes", "@language": "en-us" },
        { "@value": "数据集拉取最大字节数", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Maximum number of bytes to accept when downloading a dataset layer. Implementations must bound this value to prevent unbounded memory usage and should default to a conservative limit.",
          "@language": "en-us"
        },
        {
          "@value": "下载数据集图层时允许的最大字节数。实现必须限制该值以防止无界内存占用，并应提供保守的默认上限。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "mapRequestProxyEndpoint": {
      "@type": "xsd:string",
      "rdfs:label": [
        { "@value": "Map request proxy endpoint", "@language": "en-us" },
        { "@value": "地图请求代理端点", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Same-origin proxy endpoint used to fetch cross-origin map tile/sprite/glyph resources to avoid browser CORS failures. In static/prod deploys the proxy may not exist, so implementations should treat proxying as a development-only convenience and prefer direct cross-origin loads when the provider supports CORS. If proxying is enabled, proxy request URLs should be absolute (including runtime origin) when executed in worker contexts. The initial Style request should remain directly fetchable by the browser when possible; aborted style requests are often caused by overlay teardown/recreation (or dev StrictMode effect probes) and should be mitigated by keeping the map instance stable. If the map appears blank after refresh while requests succeed, validate that the overlay container has a non-zero height and call map.resize() after style/load/resize events.",
          "@language": "en-us"
        },
        {
          "@value": "用于拉取跨域地图瓦片/精灵图/字形资源的同源代理端点，以避免浏览器 CORS 失败。在静态/生产部署中代理端点可能不存在，因此实现应将代理视为仅开发环境的便利手段，并在提供方支持 CORS 时优先直接跨域加载。若启用代理，实现应在 worker 上下文中将代理请求 URL 构造成绝对 URL（包含运行时 origin）。初始 Style 请求应尽量由浏览器直接获取；Style 请求被中止通常来自叠加层销毁/重建（或开发环境 StrictMode 的 effect 探测），应通过保持地图实例稳定来规避。若刷新后地图空白但请求成功，应检查叠加层容器高度是否为非零，并在 style/load/resize 事件后调用 map.resize()。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "mapOverlayDisableOnExit": {
      "@type": "xsd:boolean",
      "rdfs:label": [
        { "@value": "Disable map overlay on exit", "@language": "en-us" },
        { "@value": "退出时关闭地图叠加层", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Whether the application disables the map overlay automatically when the user switches away from Geospatial Mode. If omitted, implementations should keep the overlay enabled until explicitly toggled off.",
          "@language": "en-us"
        },
        {
          "@value": "当用户切换离开地理空间模式时，应用是否自动关闭地图叠加层。如果未设置，实现应保持叠加层开启，直到用户显式关闭为止。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "geospatialModeToggle": {
      "@type": "xsd:boolean",
      "rdfs:label": [
        { "@value": "Geospatial mode toggle", "@language": "en-us" },
        { "@value": "地理空间模式开关", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Whether the UI exposes Geospatial Mode as a top-level toggle (similar to 3D Mode). When ON, implementations should enable a translucent map overlay and a map-side panel; interactivity should be configurable separately to avoid breaking graph-first affordances by default.",
          "@language": "en-us"
        },
        {
          "@value": "UI 是否将地理空间模式作为顶层开关（类似 3D 模式）。开启时实现应启用半透明地图叠加层与地图侧边栏；交互能力应作为独立配置项，以避免默认破坏以图为主的交互体验。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    },
    "geospatialMinimapPreviewEnabled": {
      "@type": "xsd:boolean",
      "rdfs:label": [
        { "@value": "Geospatial minimap basemap preview", "@language": "en-us" },
        { "@value": "地理空间缩略图底图预览", "@language": "zh-cn" }
      ],
      "rdfs:comment": [
        {
          "@value": "Whether the application embeds a non-interactive MapLibre basemap preview inside the minimap card using the same style URL and proxy configuration as Geospatial Mode. When a geospatial proximity center is active, implementations may sync the minimap basemap center and zoom to that center/radius. The minimap preview should remain decorative (no pointer capture) while the SVG graph overview and viewport rectangle remain the source of truth for interactions.",
          "@language": "en-us"
        },
        {
          "@value": "应用是否在缩略图面板内嵌入使用与地理空间模式相同样式 URL 和代理配置的非交互 MapLibre 底图预览。当存在地理空间邻近中心时，实现可以将缩略图底图的中心和缩放级别与该中心/半径保持同步。缩略图预览应保持装饰性（不捕获指针事件），同时现有 SVG 图概览和视口矩形仍然作为交互的唯一来源。",
          "@language": "zh-cn"
        }
      ],
      "required": false
    }
  }
}

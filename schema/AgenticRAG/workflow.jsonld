{
  "@context": "https://huijoohwee.github.io/schema/AgenticRAG/v1/context.jsonld",
  "@id": "rag:Workflow",
  "@type": "rdfs:Class",
  "schemaVersion": "1.1.8",
  "rdfs:label": [
    { "@value": "Workflow", "@language": "en-us" },
    { "@value": "工作流", "@language": "zh-cn" }
  ],
  "rdfs:comment": [
    {
      "@value": "Defines the structural contract for workflow-oriented UI surfaces (for example MainPanel Workflow Manager). Guidance copy should be low-verbosity in-layout and exposed via Role \u2192 Actions \u2192 Outcome tooltips, keeping the workflow step ordering reproducible and domain-agnostic.",
      "@language": "en-us"
    },
    {
      "@value": "定义工作流类 UI 界面的结构化契约（例如主面板 Workflow Manager）。指导文案应在布局中保持低冗余，并通过 Role \u2192 Actions \u2192 Outcome 工具提示呈现，使工作流步骤顺序可复现且领域无关。",
      "@language": "zh-cn"
    }
  ],
  "workflowUiGuidelines": {
    "tooltipSemantics": "Role \u2192 Actions \u2192 Outcome",
    "maxWords": 50,
    "reduceVerbosityInLayout": true,
    "oneRowHeaders": true,
    "controlHeight": "h-7",
    "statusPillHeight": "h-6",
    "toolAreaSectionPadding": "px-2 py-1",
    "workflowStep3Ingest": {
      "subsections": ["Sample Dataset", "Dataset fetch limits", "Source Files"],
      "datasetFetchLimits": {
        "layout": "keyValueRows",
        "rowRule": "One key/value per row; reuse MainPanel Settings Key/Value primitives; keep the value control right-aligned and height-aligned with other controls. These limits must be applied to bounded URL fetches and local file reads (including Source Files URL import and editor preview fetch) to avoid relying on small shared defaults."
      },
      "layoutRule": "All Step 3 subsections must share the same left/right padding and sticky header styling (do not render an out-of-band Sample Dataset block outside the Step 3 subsection stack).",
      "sourceFiles": {
        "canonicalSurface": "BottomPanel.Curation.Markdown",
        "workflowSurfaceRule": "Workflow Step 3 must not render a duplicate Source Files management table. It may only provide a single Open Markdown action that routes to the canonical Source Files surface."
      }
    },
    "sourceFilesIngestSurface": {
      "canonicalSurface": "BottomPanel.Curation.Markdown",
      "sidebarSection": "Source Files",
      "toolbarActions": ["Import local", "Import URL", "Import website", "Open in editor", "Export", "Clear", "Status"],
      "supportedImportFormats": [".md", ".markdown", ".txt", ".geojson", ".json", ".jsonld", ".csv", ".html", ".htm", ".yaml", ".yml", ".pdf", "YouTube"],
      "supportedExportFormats": [".md", ".txt", ".geojson", ".json", ".jsonld", ".csv", ".html", ".yaml"],
      "selectionRule": "Toolbar actions apply to the active Source File selected in the Source Files sidebar. If no file is active, Import actions must create a new Source File and make it active.",
      "urlInputRule": "URL import input is hidden by default and expands leftwards from the URL icon; Enter submits; Escape closes.",
      "webpageViews": {
        "activeRowDropdown": ["Markdown", "JSON", "HTML"],
        "frontmatterKeys": ["kgWebpageUrl", "kgWebpageView"],
        "viewOnlyRule": "Switching view modes must be strictly view-only: forbid apply-to-graph, layout reseeds, zoom jumps, layer mutations, and writes to default import settings (for example webpageImportView).",
        "iframeRenderMode": {
          "enforced": "sandboxed-iframe",
          "rule": "Render HTML/JSON in a sandboxed iframe using proxy-src (highest fidelity) by default. When a safe non-clipped snapshot is available (for example stored rawHtml artifacts or an explicit editor override), render via a sanitized srcdoc snapshot that upserts <base> and strips CSP/refresh meta tags to avoid self-blocking."
        },
        "iframeSecurityPolicy": {
          "sandbox": "allow-scripts",
          "referrerPolicy": "no-referrer",
          "forbid": ["allow-top-navigation"]
        },
        "modeContract": {
          "markdown": "Editor shows Markdown; Viewer/Presentation/Slides render Markdown.",
          "json": "Editor shows conversion JSON (read-only override); Viewer/Presentation/Slides render sandboxed JSON code via a sandboxed iframe (prefer srcdoc snapshot).",
          "html": "Editor shows editable Markdown SSOT; Viewer/Presentation/Slides render sandboxed HTML via a sandboxed iframe (proxy-src by default; sanitized srcdoc snapshot when available)."
        },
        "signalTokens": {
          "neutralityRule": "Signal extraction must be generic and domain-neutral with no site-specific branching.",
          "vocabulary": ["[NAV]", "[CTA]", "[LINK]", "[PRICE]", "[TIME]"],
          "reuseRule": "Layout mockups and Document Structure must use the same token prefixes as the underlying signal extraction logic."
        },
        "uiContract": {
          "editorRule": "Editor must edit the Markdown SSOT using the in-repo Monaco wrapper (textarea fallback is allowed only for non-browser test harnesses).",
          "saveRule": "The Markdown header Actions must include Save and Save As controls; they are enabled only when editing is active.",
          "stickyExplorerRule": "Explorer section headers (EXPLORER / SOURCE FILES / TOC) must remain visible while scrolling (sticky within the sidebar scroll container).",
          "scrollSyncRule": "In split view, Editor↔Viewer scroll sync must be bidirectional and view-only; it must not mutate document text or graph/layout state."
        }
      },
      "websiteImport": {
        "triggerRule": "In the Import URL UI, the Globe button triggers website import (sitemap/tree crawl).",
        "workspaceTreeRule": "Website import writes one stub Markdown file per page under /websites/<host>/<importId>/... to mirror URL path structure.",
        "frontmatterKeys": ["kgWebpageUrl", "kgWebpageView", "kgWebsiteImportId", "kgWebsiteNodeId", "kgWebsiteOutputDirRel"],
        "artifactKinds": ["rawHtml", "markdown", "conversionJson"],
        "artifactMappingRule": "For website-import pages, editor view→artifact maps as json→conversionJson, else markdown.",
        "htmlFidelityRule": "For html view, Viewer/Presentation/Slides must render 100% fidelity HTML via a sandboxed iframe; prefer stored rawHtml artifacts and fall back to the same-origin iframe proxy. JSON view renders sandboxed JSON code.",
        "optionsRule": "Website import must persist markdown/conversionJson/rawHtml artifacts per page."
      },
      "githubRepoImport": {
        "triggerRule": "In the Import URL UI, when the URL is a GitHub repository root (https://github.com/<owner>/<repo>), treat it as a repo import.",
        "outputRule": "Create a workspace folder named <repo> and write repo.sitemap.md + repo.user-journey.md inside it; focus repo.sitemap.md as the first opened editor document.",
        "folderModeContractRule": "When a folder containing repo.sitemap.md/repo.user-journey.md is selected, show a right-side dropdown that switches the Editor SSOT between Sitemap and User Journey (reuse the File Mode Contract dropdown UI).",
        "sitemapLodRule": "repo.sitemap.md must include bounded repo statistics, directory tree, extracted feature groups + per-section statistics, template showcase (grid + table), and a core entry points section derived from key source files when present.",
        "fetchRule": "Avoid per-folder GitHub contents crawling; list via the GitHub tree API and fetch file bodies via raw.githubusercontent.com.",
        "boundsRule": "Import must be bounded (max files, max tree lines, max log rows) and must continue on per-file failures while recording them.",
        "uiRule": "Emit progress via a persistent toast and record bounded progress rows into MainPanel History→Log; final state must emit success/warn/error.",
        "neutralityRule": "Do not hardcode any specific repo URLs or repo-specific output; all sitemap content must be derived from GitHub API responses and README markdown."
      }
    }
  }
}

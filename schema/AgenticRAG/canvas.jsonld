{
  "@context": "https://huijoohwee.github.io/schema/AgenticRAG/v1/context.jsonld",
  "@id": "rag:Canvas",
  "@type": "rdfs:Class",
  "schemaVersion": "1.0.10",
  "rdfs:comment": [
    {
      "@value": "Defines an interactive graph canvas surface. Invariants: (1) presentation toggles update layers without unnecessary re-layout; (2) layout positions are cached by (semanticMode, frontmatterMode, layoutMode, renderMode) with no legacy/partial cache-key fallback to forbid cross-mode contamination, and are persisted even when structured layouts stop their simulation (radial/stratify) to prevent drift when switching modes; (3) overlap prevention is schema-driven via layout.forces.{bboxCollide*, groupBboxCollide*} and reused across Force/Radial/Stratify (group bbox collision is enforced whenever layout.groups.enabled !== false; groupBboxCollide is deprecated for disabling); (4) group bbox collision must key by rendered group membership (subgraphs/headings/layers) to forbid group box overlap; (5) stratify mode is a structured tree layout derived from configured hierarchy edge labels and must use collision-safe synthetic root/group IDs; when enabled via schema.layout.stratify.grid, stratify positions snap to a grid using bounded constraint forces and clamp the effective grid size to the label-aware node AABB + padding to forbid overlap; (6) group boxes derive bounds from label-aware node AABBs; (7) render layers have a stable default Z-ordering (Groups/Clusters < LinksHit < Links < EdgeLabels < TempLink < Nodes < NodeChevrons < Media < PortHandles < Labels < GroupLabels) and may be overridden via schema.layout.mermaid.renderOrder for Mermaid-derived graphs; (8) zoom scale extents are schema-driven via schema.performance.zoom.{minScale,maxScale}; (9) zoom/fit transforms center on the graph centroid; zoom state is cached by a viewKey that includes render/layout/frontmatter/semantic modes and presentation toggles (nodes/groups) to forbid stale transforms (pinned views may carry across graph revisions; unpinned views must match graphDataRevision); fit-to-screen uses a target fill ratio computed on a capped 1920×1080 (16:9) frame (default 0.8; stratify may override via schema.layout.stratify.fitFillRatio) and must respond to UI chrome changes (e.g. sidebar toggles).",
      "@language": "en-us"
    },
    {
      "@value": "定义交互式图画布表面。关键不变量：(1) 展示开关仅更新渲染图层，避免不必要重布局；(2) 布局位置按 (semanticMode, frontmatterMode, layoutMode, renderMode) 缓存，且不允许回退到历史/部分 key（禁止跨模式污染），并在结构化布局停止模拟（radial/stratify）时也会落盘缓存，避免切换模式漂移；(3) 重叠防护通过 schema 驱动的 layout.forces.{bboxCollide*, groupBboxCollide*} 统一控制，并在 Force/Radial/Stratify 中复用（当 layout.groups.enabled !== false 时强制启用群组 bbox 碰撞；groupBboxCollide 不再用于关闭该约束）；(4) 群组 bbox 碰撞必须按“渲染出来的群组成员关系”（子图/标题层/图层）进行 keying，以禁止群组框互相重叠；(5) Stratify 模式为结构化树布局，按配置的层级边标签推导父子关系，且必须使用不会与真实节点 ID 冲突的合成 root/group ID；当通过 schema.layout.stratify.grid 启用时，Stratify 会用有界约束力将位置吸附到网格，并将有效网格尺寸钳制到“标签感知 AABB + padding”以禁止重叠；(6) 群组框边界由“标签感知”的节点 AABB 推导；(7) 渲染图层提供稳定的默认 Z 顺序（Groups/Clusters < LinksHit < Links < EdgeLabels < TempLink < Nodes < NodeChevrons < Media < PortHandles < Labels < GroupLabels），并可通过 schema.layout.mermaid.renderOrder 对 Mermaid 派生图进行覆盖；(8) 缩放范围由 schema.performance.zoom.{minScale,maxScale} 驱动；(9) 缩放/fit 变换始终以图元素质心居中；缩放状态按包含 render/layout/frontmatter/semantic 模式与 nodes/groups 展示开关的 viewKey 缓存，禁止跨视图复用导致的错位（固定视图可跨图数据版本保留；非固定视图必须匹配 graphDataRevision）；Fit-to-Screen 使用封顶 1920×1080（16:9）作为缩放计算基准，目标占屏比默认 0.8（Stratify 可由 schema.layout.stratify.fitFillRatio 覆盖），并必须对 UI 外壳变化（如侧边栏开关）作出响应。",
      "@language": "zh-cn"
    }
  ],
  "rdfs:label": [
    { "@value": "Canvas", "@language": "en-us" },
    { "@value": "画布", "@language": "zh-cn" }
  ]
}
